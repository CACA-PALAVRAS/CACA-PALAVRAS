<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ca√ßa-Palavras Tutyxs 2.0</title>
  <style>
    body {
      background: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      position: relative;
      min-height: 100vh;
      padding-bottom: 120px;
    }
    h1, h2 {
      font-size: 2rem;
      margin: 1rem 0;
    }

    button {
      padding: 15px 25px;
      margin: 10px 5px;
      font-size: 1.2rem;
      border: none;
      border-radius: 10px;
      background: #6200ea;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
    }

    button:hover {
      background: #3700b3;
    }

    .hidden {
      display: none;
    }

    .word-section {
      margin-top: 10px;
      position: relative;
      padding-top: 50px;
    }

    .word-section h3 {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }

    .word-list {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .word-list span {
      background: #444;
      padding: 5px 10px;
      border-radius: 5px;
      user-select: none;
    }

    .word-list .found {
      text-decoration: line-through;
      color: #aaa;
    }

    .grid {
      display: grid;
      gap: 6px;
      justify-content: center;
      background-color: #2c2c2c;
      padding: 15px;
      margin: 30px auto 0;
      width: fit-content;
      z-index: 1;
      position: relative;
      user-select: none;
      touch-action: none; /* evitar scroll durante toque */
    }

    .cell {
      width: 42px;
      height: 42px;
      background: #444;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border-radius: 5px;
      user-select: none;
      cursor: pointer;
    }

    .selected {
      background-color: #240046;
    }

    .correct {
      background-color: #000080;
    }

    #gameButtons {
      margin-top: 60px;
      display: flex;
      justify-content: center;
      gap: 15px;
      align-items: center;
      position: relative;
      z-index: 2;
      flex-wrap: wrap;
    }

    #musicBtn {
      background: #333;
      padding: 8px 16px;
      font-size: 1.3rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      border: none;
      color: white;
      transition: background 0.3s;
    }

    #musicBtn:hover {
      background: #555;
    }

    #resetScoreBtn {
      background: #aa0000;
      padding: 6px 12px;
      font-size: 0.9rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      border: none;
      color: white;
      transition: background 0.3s;
      height: 32px;
      line-height: 20px;
      align-self: center;
      white-space: nowrap;
    }

    #resetScoreBtn:hover {
      background: #cc2222;
    }

    #score {
      position: fixed;
      top: 8px;
      right: 8px;
      font-size: 1rem;
      background: #240046;
      padding: 6px 5px;
      border-radius: 8px;
      user-select: none;
      z-index: 1000;
      display: none;
      color: white;
    }

    #level {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.3rem;
      background: #240046;
      padding: 6px 16px;
      border-radius: 10px;
      user-select: none;
      color: white;
      font-weight: bold;
      z-index: 10;
    }

    .grid.zoomed {
      transform: scale(1.2);
      transform-origin: center top;
      transition: transform 0.3s ease;
    }

    #catalogoMusicas {
      background: #222;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    #catalogoMusicas.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1 id="welcome">Bem-vindo ao Ca√ßa-Palavras do Tutyxs 2.0</h1>
  <h2 id="score">Pontua√ß√£o: 0</h2>
  <button id="startBtn">Come√ßar Jogo</button>

  <div id="difficulty" class="hidden">
    <h2>Escolha a Dificuldade</h2>
    <button onclick="setDifficulty('facil')">F√°cil</button>
    <button onclick="setDifficulty('medio')">M√©dio</button>
    <button onclick="setDifficulty('dificil')">Dif√≠cil</button>
  </div>

  <div id="themes" class="hidden">
    <h2>Escolha o Tema</h2>
    <div style="overflow-x:auto; white-space:nowrap;">
      <button onclick="startGame('Tecnologia')">Tecnologia</button>
      <button onclick="startGame('Animais')">Animais</button>
      <button onclick="startGame('Escola')">Escola</button>
      <button onclick="startGame('Frutas')">Frutas</button>
      <button onclick="startGame('Espa√ßo')">Espa√ßo</button>
    </div>
  </div>

  <!-- Bot√£o para abrir o cat√°logo -->
  <button id="trocarMusicaBtn" class="hidden">üéµ Trocar M√∫sica</button>

  <!-- Cat√°logo escondido -->
  <div id="catalogoMusicas" class="hidden">
    <h3>Escolha uma m√∫sica:</h3>
    <ul style="list-style:none; padding:0;">
      <li><button onclick="trocarMusica('musica1.mp3')">M√∫sica 1</button></li>
      <li><button onclick="trocarMusica('musica2.mp3')">M√∫sica 2</button></li>
      <li><button onclick="trocarMusica('musica3.mp3')">M√∫sica 3</button></li>
    </ul>
  </div>

  <div id="gameArea" class="hidden">
    <div class="word-section">
      <div id="level">N√≠vel 1</div>
      <h3>Palavras para encontrar</h3>
      <div class="word-list" id="wordList"></div>
    </div>
    <div id="grid" class="grid"></div>
    <div id="gameButtons">
      <button id="backBtn" onclick="location.reload()">Voltar ao In√≠cio</button>
      <button id="musicBtn">üéµ M√∫sica</button>
      <button id="resetScoreBtn">Resetar Pontua√ß√£o</button>
    </div>
  </div>

  <audio id="music" src="musica1.mp3" loop></audio>
  <audio id="success" src="success.mp3"></audio>
  <audio id="fail" src="fail.mp3"></audio>
  <audio id="bubbleSound" src="bolha.mp3"></audio>

  <script>
    const wordsByTheme = {
      'Tecnologia': [
        'APP', 'CLOUD', 'JAVA', 'HTML', 'LINUX', 'SENHA', 'ROBOT', 'WIFI', 'DADOS', 'CODIGO',
        'BYTE', 'SCRIPT', 'LOGIN', 'MOUSE', 'NAVEGADOR', 'PLUGIN', 'PIXEL', 'PROTOCOLO', 'CSS', 'API',
        'BYTECODE', 'CACHE', 'DOMINIO', 'FRAME', 'GITHUB', 'HOST', 'IP', 'JAVASCRIPT', 'KERNEL', 'LOG',
        'MODULO', 'NODE', 'OVERRIDE', 'PATCH', 'QUERY', 'REDE', 'SERVER', 'TOKEN', 'URL', 'VPN'
      ],
      'Animais': [
        'GATO', 'CAO', 'TIGRE', 'PANDA', 'CAVALO', 'RATO', 'CISNE', 'URSO', 'ZEBRA', 'FOCA',
        'AGUIA', 'BODE', 'CAMELO', 'DROMEDARIO', 'ELEFANTE', 'FALCAO', 'GIRAFA', 'HIPOPOTAMO', 'IBIS', 'JACARE',
        'KIWI', 'LEAO', 'MACACO', 'NARVAL', 'ORNITORRINCO', 'PATO', 'QUATI', 'RAPOSA', 'SERPENTE', 'TATU',
        'URUBU', 'VEADO', 'WAPITI', 'XEREM', 'ZANGAO', 'ZEBU', 'ARARA', 'BALEIA', 'CORUJA', 'DAGUA'
      ],
      'Escola': [
        'LIVRO', 'LAPIS', 'PROVA', 'RECREIO', 'LICAO', 'MESA', 'QUADRO', 'TEXTO', 'AULA', 'NOTA',
        'APONTAMENTO', 'BIBLIOTECA', 'CADERNO', 'DICIONARIO', 'ENSINO', 'FORMULA', 'GRUPO', 'HISTORIA', 'INDICE', 'JANELA',
        'LIVRODIDATICO', 'MATEMATICA', 'NUMERO', 'ORDEM', 'PLANO', 'QUESTAO', 'REDACAO', 'SALA', 'TAREFA', 'UNIFORME',
        'VESTIBULAR', 'XEROX', 'ZONA', 'ALUNO', 'BLOCO', 'CLASSE', 'DIA', 'EXERCICIO', 'FREQUENCIA', 'GEOGRAFIA'
      ],
      'Frutas': [
        'UVA', 'PERA', 'BANANA', 'MACA', 'KIWI', 'LIMAO', 'COCO', 'FIGO', 'AMEIXA', 'JABUTI',
        'ABACATE', 'ABACAXI', 'ACEROLA', 'CAJU', 'CARAMBOLA', 'DAMASCO', 'FRAMBOESA', 'GOIABA', 'JACA', 'MANGA',
        'MARACUJA', 'MELANCIA', 'MELAO', 'MIRTILO', 'NECTARINA', 'PEIXE', 'PITANGA', 'ROMA', 'TANGERINA', 'TOMATE',
        'CAQUI', 'GRAVIOLA', 'LARANJA', 'MIRABELA', 'PAPAYA', 'PITAYA', 'ROMA', 'SIRIGUELA', 'TAMARINDO', 'TORANJA'
      ],
      'Espa√ßo': [
        'SOL', 'LUZ', 'TERRA', 'SATURNO', 'ASTRO', 'VIA', 'NEBULOSA', 'ROVER', 'NASA', 'FOTON',
        'ASTEROIDE', 'COMETA', 'CONSTELACAO', 'COSMOS', 'CRATERA', 'ECLIPSE', 'GALAXIA', 'GRAVIDADE', 'LUA', 'METEORO',
        'ORBITA', 'PLANETA', 'QUASAR', 'RADIACAO', 'SATELITE', 'SOLAR', 'SUPERNOVA', 'TELURIA', 'TELURUS', 'TELURICO',
        'TELESCOPIO', 'URANO', 'VENUS', 'ZODIACO', 'BURACONEGRO', 'ESTRELA', 'FUSAO', 'VENUS', 'MERCURIO'
      ]
    };

    const startBtn = document.getElementById('startBtn');
    const welcome = document.getElementById('welcome');
    const difficultyDiv = document.getElementById('difficulty');
    const themesDiv = document.getElementById('themes');
    const gameArea = document.getElementById('gameArea');
    const wordListDiv = document.getElementById('wordList');
    const gridDiv = document.getElementById('grid');
    const music = document.getElementById('music');
    const success = document.getElementById('success');
    const fail = document.getElementById('fail');
    const musicBtn = document.getElementById('musicBtn');
    const scoreEl = document.getElementById('score');
    const resetScoreBtn = document.getElementById('resetScoreBtn');
    const levelEl = document.getElementById('level');
    const trocarMusicaBtn = document.getElementById('trocarMusicaBtn');
    const catalogoMusicas = document.getElementById('catalogoMusicas');
    const bubbleSound = document.getElementById('bubbleSound');

    let grid = [];
    let selectedWords = [];
    let foundWords = [];
    let gridSize = 10;
    let wordCount = 10;
    let score = 0;
    let currentTheme = null;
    let currentLevel = null;
    let currentGameLevel = 1;

    let isSelecting = false;
    let selectedCells = [];
    let startCell = null;
    let lastCellCoords = null;

    // Inicia jogo - abre sele√ß√£o de dificuldade
    startBtn.onclick = () => {
      bubbleSound.play();
      startBtn.classList.add('hidden');
      welcome.classList.add('hidden');
      difficultyDiv.classList.remove('hidden');
      loadScore();
    };

    function setDifficulty(level) {
      bubbleSound.play();
      difficultyDiv.classList.add('hidden');
      themesDiv.classList.remove('hidden');
      currentLevel = level;
      currentGameLevel = 1;
      updateLevel();

      if (level === 'facil') {
        gridSize = 6;
        wordCount = 4;
        gridDiv.classList.add('zoomed');
      } else if (level === 'medio') {
        gridSize = 8;
        wordCount = 7;
        gridDiv.classList.remove('zoomed');
      } else {
        gridSize = 10;
        wordCount = 10;
        gridDiv.classList.remove('zoomed');
      }
    }

    function updateLevel() {
      levelEl.textContent = `N√≠vel ${currentGameLevel}`;
    }

    function loadScore() {
      const saved = localStorage.getItem('ca√ßaPalavrasScore');
      if (saved !== null) {
        score = parseInt(saved, 10);
      } else {
        score = 0;
      }
      updateScore();
    }

    function saveScore() {
      localStorage.setItem('ca√ßaPalavrasScore', score);
    }

    function resetScore() {
      bubbleSound.play();
      score = 0;
      updateScore();
      saveScore();
      alert('Pontua√ß√£o resetada!');
    }

    resetScoreBtn.onclick = resetScore;

    function startGame(theme) {
      bubbleSound.play();
      currentTheme = theme;
      scoreEl.style.display = 'block';
      themesDiv.classList.add('hidden');
      gameArea.classList.remove('hidden');
      trocarMusicaBtn.classList.remove('hidden');

      // Ajusta gridSize e wordCount conforme dificuldade e n√≠vel atual
      if (currentLevel === 'facil') {
        gridSize = Math.min(6 + currentGameLevel - 1, 10);
        wordCount = Math.min(4 + currentGameLevel - 1, 10);
        gridDiv.classList.add('zoomed');
      } else if (currentLevel === 'medio') {
        gridSize = Math.min(8 + currentGameLevel - 1, 12);
        wordCount = Math.min(7 + currentGameLevel - 1, 15);
        gridDiv.classList.remove('zoomed');
      } else {
        gridSize = Math.min(10 + currentGameLevel - 1, 15);
        wordCount = Math.min(10 + currentGameLevel - 1, 20);
        gridDiv.classList.remove('zoomed');
      }

      updateLevel();

      // seleciona palavras que cabem no grid, filtrando as maiores que o grid
      const possibleWords = wordsByTheme[theme].filter(w => w.length <= gridSize);
      selectedWords = shuffleArray(possibleWords).slice(0, wordCount);
      foundWords = [];
      createGrid();
      music.play();
      musicBtn.textContent = "Pausar M√∫sica";
    }

    function shuffleArray(arr) {
      let array = arr.slice();
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function randomLetter() {
      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      return letters.charAt(Math.floor(Math.random() * letters.length));
    }

    function createGrid() {
      grid = [];
      gridDiv.innerHTML = '';
      gridDiv.style.gridTemplateColumns = `repeat(${gridSize}, 42px)`;
      gridDiv.style.gridTemplateRows = `repeat(${gridSize}, 42px)`;

      for (let i = 0; i < gridSize; i++) {
        grid[i] = [];
        for (let j = 0; j < gridSize; j++) {
          grid[i][j] = '';
        }
      }

      // Tenta colocar cada palavra na grade
      selectedWords.forEach(word => {
        placeWordInGrid(word);
      });

      // Preenche as posi√ß√µes vazias com letras aleat√≥rias
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          if (grid[i][j] === '') {
            grid[i][j] = randomLetter();
          }
        }
      }

      // Cria as c√©lulas no DOM
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.textContent = grid[i][j];
          cell.dataset.row = i;
          cell.dataset.col = j;

          // Eventos toque e mouse para sele√ß√£o
          cell.addEventListener('mousedown', startSelection);
          cell.addEventListener('touchstart', startSelection, {passive: false});
          cell.addEventListener('mouseenter', moveSelection);
          cell.addEventListener('touchmove', moveSelection, {passive: false});
          cell.addEventListener('mouseup', endSelection);
          cell.addEventListener('touchend', endSelection);

          gridDiv.appendChild(cell);
        }
      }

      // Mostra a lista das palavras
      updateWordList();
    }

    // Tenta colocar palavra no grid numa posi√ß√£o aleat√≥ria com uma dire√ß√£o aleat√≥ria
    function placeWordInGrid(word) {
      const directions = [
        {x: 1, y: 0},   // horizontal direita
        {x: -1, y: 0},  // horizontal esquerda
        {x: 0, y: 1},   // vertical baixo
        {x: 0, y: -1},  // vertical cima
        {x: 1, y: 1},   // diagonal direita baixo
        {x: 1, y: -1},  // diagonal direita cima
        {x: -1, y: 1},  // diagonal esquerda baixo
        {x: -1, y: -1}  // diagonal esquerda cima
      ];

      let placed = false;
      let attempts = 0;
      while (!placed && attempts < 1000) {
        attempts++;
        const dir = directions[Math.floor(Math.random() * directions.length)];
        const startX = Math.floor(Math.random() * gridSize);
        const startY = Math.floor(Math.random() * gridSize);

        // Verifica se a palavra cabe
        let fits = true;
        let x = startX;
        let y = startY;

        for (let i = 0; i < word.length; i++) {
          if (
            x < 0 || x >= gridSize ||
            y < 0 || y >= gridSize
          ) {
            fits = false;
            break;
          }
          if (grid[y][x] !== '' && grid[y][x] !== word[i]) {
            fits = false;
            break;
          }
          x += dir.x;
          y += dir.y;
        }

        if (fits) {
          // Coloca a palavra no grid
          x = startX;
          y = startY;
          for (let i = 0; i < word.length; i++) {
            grid[y][x] = word[i];
            x += dir.x;
            y += dir.y;
          }
          placed = true;
        }
      }
    }

    function updateWordList() {
      wordListDiv.innerHTML = '';
      selectedWords.forEach(word => {
        const span = document.createElement('span');
        span.textContent = word;
        if (foundWords.includes(word)) {
          span.classList.add('found');
        }
        wordListDiv.appendChild(span);
      });
    }

    // Seletor de c√©lulas para o toque / clique

    function startSelection(e) {
      e.preventDefault();
      bubbleSound.play();
      clearSelection();
      isSelecting = true;
      const cell = e.target;
      startCell = cell;
      lastCellCoords = {row: +cell.dataset.row, col: +cell.dataset.col};
      selectedCells.push(cell);
      cell.classList.add('selected');
    }

    function moveSelection(e) {
      if (!isSelecting) return;

      e.preventDefault();

      let clientX, clientY;
      if (e.type === 'touchmove') {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }

      const elem = document.elementFromPoint(clientX, clientY);
      if (!elem || !elem.classList.contains('cell')) return;

      const row = +elem.dataset.row;
      const col = +elem.dataset.col;

      // Se a c√©lula j√° foi selecionada, ignora
      if (selectedCells.includes(elem)) return;

      // Calcula o vetor da sele√ß√£o inicial at√© a c√©lula atual
      const startRow = +startCell.dataset.row;
      const startCol = +startCell.dataset.col;

      const dRow = row - startRow;
      const dCol = col - startCol;

      // Se o movimento n√£o est√° numa linha reta nas 8 dire√ß√µes v√°lidas, ignora
      // Valida dire√ß√£o: horizontal, vertical e diagonais s√≥
      if (
        !(dRow === 0 || dCol === 0 || Math.abs(dRow) === Math.abs(dCol))
      ) return;

      // Determina o passo unit√°rio para iterar entre start e c√©lula atual
      const stepRow = dRow === 0 ? 0 : dRow / Math.abs(dRow);
      const stepCol = dCol === 0 ? 0 : dCol / Math.abs(dCol);

      // Limpa sele√ß√£o anterior e seleciona tudo da startCell at√© elem
      clearSelection();
      selectedCells = [];
      let r = startRow;
      let c = startCol;

      while (true) {
        const cellAt = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
        if (!cellAt) break;
        cellAt.classList.add('selected');
        selectedCells.push(cellAt);
        if (r === row && c === col) break;
        r += stepRow;
        c += stepCol;
      }
    }

    function endSelection(e) {
      if (!isSelecting) return;
      isSelecting = false;

      // Pega a palavra selecionada na ordem das c√©lulas selecionadas
      const selectedWord = selectedCells.map(c => c.textContent).join('');
      const selectedWordReversed = selectedCells.map(c => c.textContent).reverse().join('');

      // Verifica se a palavra selecionada est√° na lista de palavras
      if (selectedWords.includes(selectedWord)) {
        markWordFound(selectedWord, selectedCells);
      } else if (selectedWords.includes(selectedWordReversed)) {
        markWordFound(selectedWordReversed, selectedCells);
      } else {
        fail.play();
        clearSelection();
        return;
      }

      clearSelection();

      // Verifica se o jogador achou todas as palavras
      if (foundWords.length === selectedWords.length) {
        score += 10 * currentGameLevel;
        alert(`Parab√©ns! Voc√™ encontrou todas as palavras! +${10 * currentGameLevel} pontos.`);
        currentGameLevel++;
        saveScore();
        updateScore();
        resetGameForNextLevel();
      }
    }

    function markWordFound(word, cells) {
      if (foundWords.includes(word)) return;
      foundWords.push(word);
      success.play();

      // Marca as c√©lulas da palavra com a classe 'correct'
      cells.forEach(c => {
        c.classList.add('correct');
        c.classList.remove('selected');
      });

      updateWordList();
    }

    function clearSelection() {
      selectedCells.forEach(c => c.classList.remove('selected'));
      selectedCells = [];
    }

    function updateScore() {
      scoreEl.textContent = `Pontua√ß√£o: ${score}`;
    }

    function resetGameForNextLevel() {
      // Atualiza o n√≠vel e reinicia o jogo com o mesmo tema
      updateLevel();
      startGame(currentTheme);
    }

    // Bot√£o para pausar e tocar m√∫sica
    musicBtn.onclick = () => {
      if (music.paused) {
        music.play();
        musicBtn.textContent = "Pausar M√∫sica";
      } else {
        music.pause();
        musicBtn.textContent = "Tocar M√∫sica";
      }
    };

    // Bot√£o para mostrar/esconder cat√°logo de m√∫sicas
    trocarMusicaBtn.onclick = () => {
      if (catalogoMusicas.classList.contains('hidden')) {
        catalogoMusicas.classList.remove('hidden');
      } else {
        catalogoMusicas.classList.add('hidden');
      }
    };

    function trocarMusica(musica) {
      music.pause();
      music.src = musica;
      music.play();
      catalogoMusicas.classList.add('hidden');
      musicBtn.textContent = "Pausar M√∫sica";
      bubbleSound.play();
    }

    // Sons est√£o em arquivos musica1.mp3, musica2.mp3, musica3.mp3, success.mp3, fail.mp3, bolha.mp3
    // Para testar som bolha: bubbleSound.play();

  </script>
</body>
</html>