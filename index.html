<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ca√ßa-Palavras Tutyxs 3.0</title>
  <style>
    body {
      background: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
      position: relative;
      min-height: 100vh;
      padding-bottom: 40px;
    }
    h1, h2 {
      font-size: 2rem;
      margin: 1rem 0;
    }

    button {
      padding: 15px 25px;
      margin: 10px 5px;
      font-size: 1.2rem;
      border: none;
      border-radius: 10px;
      background: #6200ea;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
      user-select: none;
    }

    button:hover {
      background: #3700b3;
    }

    .hidden {
      display: none;
    }

    .word-section {
      margin-top: 10px;
      position: relative;
      padding-top: 50px;
    }

    .word-section h3 {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }

    .word-list {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .word-list span {
      background: #444;
      padding: 5px 10px;
      border-radius: 5px;
      user-select: none;
    }

    .word-list .found {
      text-decoration: line-through;
      color: #aaa;
    }

    .grid {
  display: grid;
  gap: 6px;
  justify-content: center;
  background-color: #2c2c2c;
  padding: 15px;
  margin: 30px auto 10px; /* üîß margin-bottom reduzida */
  z-index: 1;
  position: relative;
  user-select: none;
  touch-action: none;
  max-width: 100vw; /* evita ultrapassar a largura da tela */
}
    .cell {
      width: 42px;
      height: 42px;
      background: #444;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border-radius: 5px;
      user-select: none;
      cursor: pointer;
    }

    .selected {
      background-color: #240046;
    }

    .correct {
      background-color: #000080;
    }

    #gameButtons {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 15px;
      align-items: center;
      position: relative;
      z-index: 2;
      flex-wrap: wrap;
    }

    #musicBtn {
      background: #333;
      padding: 8px 16px;
      font-size: 1.3rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      border: none;
      color: white;
      transition: background 0.3s;
    }

    #musicBtn:hover {
      background: #555;
    }

    #resetScoreBtn {
      background: #aa0000;
      padding: 6px 12px;
      font-size: 0.9rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      border: none;
      color: white;
      transition: background 0.3s;
      height: 32px;
      line-height: 20px;
      align-self: center;
      white-space: nowrap;
    }

    #resetScoreBtn:hover {
      background: #cc2222;
    }

    #score {
      position: fixed;
      top: 8px;
      right: 8px;
      font-size: 1rem;
      background: #240046;
      padding: 6px 5px;
      border-radius: 8px;
      user-select: none;
      z-index: 1000;
      display: none;
      color: white;
    }

    #level {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.3rem;
      background: #240046;
      padding: 6px 16px;
      border-radius: 10px;
      user-select: none;
      color: white;
      font-weight: bold;
      z-index: 10;
    }

    #gridWrapper {
  margin-bottom: 0;
  padding: 0;
}

    #catalogoMusicas {
      background: #222;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      max-width: 300px;
      margin-left: auto;
      margin-right: auto;
    }

    #catalogoMusicas.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1 id="welcome">
  Bem-vindo ao Ca√ßa-Palavras do Tutyxs 3.0
  <button id="colorThemeBtn" style="font-size: 0.8rem; margin-left: 10px; padding: 4px 8px;">temas</button>
  <label id="wallpaperLabel" for="uploadWallpaper" style="font-size: 0.8rem; margin-left: 10px; padding: 4px 8px; background: #6200ea; color: white; border-radius: 6px; cursor: pointer;">Escolher wallpaper</label>
  <input type="file" id="uploadWallpaper" accept="image/*" style="display: none;" />
</h1>
  <h2 id="score">Pontua√ß√£o: 0</h2>
  <button id="startBtn">Come√ßar Jogo</button>

  <div id="difficulty" class="hidden">
    <h2>Escolha a Dificuldade</h2>
    <button onclick="setDifficulty('facil')">F√°cil</button>
    <button onclick="setDifficulty('medio')">M√©dio</button>
    <button onclick="setDifficulty('dificil')">Dif√≠cil</button>
  </div>

  <div id="themes" class="hidden">
    <h2>Escolha o Tema</h2>
    <div style="overflow-x:auto; white-space:nowrap;">
      <button onclick="startGame('Tecnologia')">Tecnologia</button>
      <button onclick="startGame('Animais')">Animais</button>
      <button onclick="startGame('Escola')">Escola</button>
      <button onclick="startGame('Frutas')">Frutas</button>
      <button onclick="startGame('Espa√ßo')">Espa√ßo</button>
    </div>
  </div>


<div id="updateModal" style="
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  color: white;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  text-align: center;
  padding: 20px;
">
  <button id="closeUpdateModal" style="
    position: absolute;
    top: 15px;
    right: 20px;
    font-size: 1.7rem;
    background: none;
    color: white;
    border: none;
    cursor: pointer;
    z-index: 10000;
  ">‚úñ</button>

  <h2 style="font-size: 2rem;">üéâ Bem-vindo a vers√£o 3.0 do Ca√ßa-Palavras do tutyxs!</h2>
  <p style="max-width: 500px; margin-top: 15px; font-size: 1.1rem;">
    Agora o jogo est√° mais completo do que nunca! Veja as novidades:
    <br><br>
    ‚úÖ Escolher wallpaper personalizado<br>
    ‚úÖ Troca de temas com apenas um clique<br>
    ‚úÖ Bot√£o para trocar m√∫sica<br>
    ‚úÖ V√°rias m√∫sicas dispon√≠veis pra voc√™ curtir üéµ<br>
    ‚úÖ Sistema de pontua√ß√£o com n√≠veis<br>
    ‚úÖ Avance de fase ao encontrar todas as palavras üí™
  </p>
</div>

  <!-- Bot√£o para abrir o cat√°logo -->
  <button id="trocarMusicaBtn" class="hidden">trocar M√∫sica</button>
<button id="playerBtn" class="hidden" style="font-size: 0.9rem;">‚ô´</button>
  <!-- Cat√°logo escondido -->
  <div id="catalogoMusicas" class="hidden">
    <h3>Escolha uma m√∫sica:</h3>
    <ul style="list-style:none; padding:0;">
<li><button onclick="trocarMusica('No 1 party Anthem.mp3')">No 1 party Anthem </button></li>
<li><button onclick="trocarMusica('Again.mp3')">Again</button></li>
<li><button onclick="trocarMusica('Back to friends.mp3')">Back to friend</button></li>
<li><button onclick="trocarMusica('Get you.mp3')">Get you</button></li>
<li><button onclick="trocarMusica('Lover you should‚Äòve come over.mp3')">Lover you should've come over </button></li>
<li><button onclick="trocarMusica('Superpowes.mp3')">Superpowes</button></li>
<li><button onclick="trocarMusica('Les.mp3')">Les</button></li>
<li><button onclick="trocarMusica('Nights like this.mp3')">Nights like this</button></li>
<li><button onclick="trocarMusica('Tem que tirar o chap√©u.mp3')">Tem que tirar o chap√©u</button></li>
<li><button onclick="trocarMusica('Montagem xonada.mp3')">Montagem xonada</button></li>
<li><button onclick="trocarMusica('Dia del√≠cia.mp3')">Dia del√≠cia</button></li>
<li><button onclick="trocarMusica('Montagem bandido.mp3')">Montagem bandido</button></li>
   
    </ul>
  </div>


<div id="playerContainer" class="hidden" style="margin-top: 10px; text-align: center;">
  <div id="musicName" style="margin-bottom: 5px; font-weight: bold;"></div>
  <input type="range" id="seekBar" value="0" min="0" step="0.01" style="width: 300px;">
  <div style="margin-top: 5px;">
    <button onclick="voltar10s()">‚èÆ</button>
    <button onclick="avancar10s()">‚è≠</button>
  </div>
</div>




  <div id="gameArea" class="hidden">
    <div class="word-section">
      <div id="level">N√≠vel 1</div>
      <h3>Palavras para encontrar</h3>
      <div class="word-list" id="wordList"></div>
    </div>
<div id="gridWrapper" style="display: flex; justify-content: center;">
  <div id="grid" class="grid"></div>
</div>
    <div id="gameButtons">
    <button id="backBtn">Voltar ao In√≠cio</button>
      <button id="musicBtn">üéµ M√∫sica</button>
      <button id="resetScoreBtn">Resetar Pontua√ß√£o</button>
    </div>
  </div>

  <audio id="music" src="No 1 party Anthem.mp3" loop></audio>
  <audio id="success" src="success.mp3"></audio>
  <audio id="fail" src="fail.mp3"></audio>
  <audio id="bubbleSound" src="bolha.mp3"></audio>

  <script>
    const wordsByTheme = {
      'Tecnologia': [
        'APP', 'CLOUD', 'JAVA', 'HTML', 'LINUX', 'SENHA', 'ROBOT', 'WIFI', 'DADOS', 'CODIGO',
        'BYTE', 'SCRIPT', 'LOGIN', 'MOUSE', 'NAVEGADOR', 'PLUGIN', 'PIXEL', 'PROTOCOLO', 'CSS', 'API',
        'BYTECODE', 'CACHE', 'DOMINIO', 'FRAME', 'GITHUB', 'HOST', 'IP', 'JAVASCRIPT', 'KERNEL', 'LOG',
        'MODULO', 'NODE', 'OVERRIDE', 'PATCH', 'QUERY', 'REDE', 'SERVER', 'TOKEN', 'URL', 'VPN'
      ],
      'Animais': [
        'GATO', 'CAO', 'TIGRE', 'PANDA', 'CAVALO', 'RATO', 'CISNE', 'URSO', 'ZEBRA', 'FOCA',
        'AGUIA', 'BODE', 'CAMELO', 'DROMEDARIO', 'ELEFANTE', 'FALCAO', 'GIRAFA', 'HIPOPOTAMO', 'IBIS', 'JACARE',
        'KIWI', 'LEAO', 'MACACO', 'NARVAL', 'ORNITORRINCO', 'PATO', 'QUATI', 'RAPOSA', 'SERPENTE', 'TATU',
        'URUBU', 'VEADO', 'WAPITI', 'XEREM', 'ZANGAO', 'ZEBU', 'ARARA', 'BALEIA', 'CORUJA', 'DAGUA'
      ],
      'Escola': [
        'LIVRO', 'LAPIS', 'PROVA', 'RECREIO', 'LICAO', 'MESA', 'QUADRO', 'TEXTO', 'AULA', 'NOTA',
        'APONTAMENTO', 'BIBLIOTECA', 'CADERNO', 'DICIONARIO', 'ENSINO', 'FORMULA', 'GRUPO', 'HISTORIA', 'INDICE', 'JANELA',
        'LIVRODIDATICO', 'MATEMATICA', 'NUMERO', 'ORDEM', 'PLANO', 'QUESTAO', 'REDACAO', 'SALA', 'TAREFA', 'UNIFORME',
        'VESTIBULAR', 'XEROX', 'ZONA', 'ALUNO', 'BLOCO', 'CLASSE', 'DIA', 'EXERCICIO', 'FREQUENCIA', 'GEOGRAFIA'
      ],
      'Frutas': [
        'UVA', 'PERA', 'BANANA', 'MACA', 'KIWI', 'LIMAO', 'COCO', 'FIGO', 'AMEIXA', 'JABUTI',
        'ABACATE', 'ABACAXI', 'ACEROLA', 'CAJU', 'CARAMBOLA', 'DAMASCO', 'FRAMBOESA', 'GOIABA', 'JACA', 'MANGA',
        'MARACUJA', 'MELANCIA', 'MELAO', 'MIRTILO', 'NECTARINA', 'PEIXE', 'PITANGA', 'ROMA', 'TANGERINA', 'TOMATE',
        'CAQUI', 'GRAVIOLA', 'LARANJA', 'MIRABELA', 'PAPAYA', 'PITAYA', 'ROMA', 'SIRIGUELA', 'TAMARINDO', 'TORANJA'
      ],
      'Espa√ßo': [
        'SOL', 'LUZ', 'TERRA', 'SATURNO', 'ASTRO', 'VIA', 'NEBULOSA', 'ROVER', 'NASA', 'FOTON',
        'ASTEROIDE', 'COMETA', 'CONSTELACAO', 'COSMOS', 'CRATERA', 'ECLIPSE', 'GALAXIA', 'GRAVIDADE', 'LUA', 'METEORO',
        'ORBITA', 'PLANETA', 'QUASAR', 'RADIACAO', 'SATELITE', 'SOLAR', 'SUPERNOVA', 'TELURIA', 'TELURUS', 'TELURICO',
        'TELESCOPIO', 'URANO', 'VENUS', 'ZODIACO', 'BURACONEGRO', 'ESTRELA', 'FUSAO', 'VENUS', 'MERCURIO'
      ]
    };
// Aplica o wallpaper salvo se existir
const savedWallpaper = localStorage.getItem('wallpaperTutyxs');
if (savedWallpaper) {
  document.body.style.backgroundImage = `url('${savedWallpaper}')`;
  document.body.style.backgroundSize = 'cover';
  document.body.style.backgroundPosition = 'center';
  document.body.style.backgroundRepeat = 'no-repeat';
}
    const startBtn = document.getElementById('startBtn');
    const welcome = document.getElementById('welcome');
    const difficultyDiv = document.getElementById('difficulty');
    const themesDiv = document.getElementById('themes');
    const gameArea = document.getElementById('gameArea');
    const wordListDiv = document.getElementById('wordList');
    const gridDiv = document.getElementById('grid');
    const music = document.getElementById('music');
    const success = document.getElementById('success');
    const fail = document.getElementById('fail');
    const musicBtn = document.getElementById('musicBtn');
    const scoreEl = document.getElementById('score');
    const resetScoreBtn = document.getElementById('resetScoreBtn');
    const levelEl = document.getElementById('level');
    const trocarMusicaBtn = document.getElementById('trocarMusicaBtn');
    const catalogoMusicas = document.getElementById('catalogoMusicas');
    const bubbleSound = document.getElementById('bubbleSound');

    let grid = [];
    let selectedWords = [];
    let foundWords = [];
    let gridSize = 10;
    let wordCount = 10;
    let score = 0;
    let currentTheme = null;
    let currentLevel = null;
    let currentGameLevel = 1;

    let isSelecting = false;
    let selectedCells = [];
    let startCell = null;
    let lastCellCoords = null;

    // Inicia jogo - abre sele√ß√£o de dificuldade
    startBtn.onclick = () => {
      bubbleSound.play();
      startBtn.classList.add('hidden');
      welcome.classList.add('hidden');
colorThemeBtn.classList.add('hidden');
      difficultyDiv.classList.remove('hidden');
      loadScore();
    };

    function setDifficulty(level) {
  bubbleSound.play(); // Som toca ao clicar nos bot√µes de dificuldade
  difficultyDiv.classList.add('hidden');
  themesDiv.classList.remove('hidden');
  currentLevel = level;
  updateLevel(); 
}
     

    function updateLevel() {
      levelEl.textContent = `N√≠vel ${currentGameLevel}`;
    }

    function loadScore() {
      const saved = localStorage.getItem('ca√ßaPalavrasScore');
      if (saved !== null) {
        score = parseInt(saved, 10);
      } else {
        score = 0;
      }
      updateScore();
    }

    function saveScore() {
      localStorage.setItem('ca√ßaPalavrasScore', score);
    }

    function resetScore() {
      bubbleSound.play();
      score = 0;
      updateScore();
      saveScore();
      alert('Pontua√ß√£o resetada!');
    }

    resetScoreBtn.onclick = resetScore;

    function startGame(theme) {
      bubbleSound.play();
      currentTheme = theme;
      scoreEl.style.display = 'block';
      themesDiv.classList.add('hidden');
      gameArea.classList.remove('hidden');
      trocarMusicaBtn.classList.remove('hidden');
     playerBtn.classList.remove('hidden');

if (currentLevel === 'facil') {
  gridSize = 6;
  wordCount = 4;
  cellSize = 36; // ‚¨ÖÔ∏è tamanho da c√©lula
  gridDiv.style.transform = '';
  gridDiv.style.marginBottom = '';
} else if (currentLevel === 'medio') {
  gridSize = 8;
  wordCount = 7;
  cellSize = 44; // ‚¨ÖÔ∏è tamanho da c√©lula
  gridDiv.style.transform = 'scale(1)';
  gridDiv.style.marginBottom = '';
} else {
  gridSize = 10;
  wordCount = 10;
  cellSize = 54; // ‚¨ÖÔ∏è tamanho da c√©lula
  gridDiv.style.transform = 'scale(0.90)';
  gridDiv.style.marginBottom = '10px';
  document.getElementById('gridWrapper').style.height = `${gridSize * cellSize}px`;
  document.getElementById('gameButtons').style.marginTop = '-40px';
}

// Aplica tamanho da grade (igual pra todos)
gridDiv.style.gridTemplateColumns = `repeat(${gridSize}, ${cellSize}px)`;
gridDiv.style.gridTemplateRows = `repeat(${gridSize}, ${cellSize}px)`;

gridDiv.style.transformOrigin = 'top center';
updateLevel();

      updateLevel();

      // seleciona palavras que cabem no grid, filtrando as maiores que o grid
      const possibleWords = wordsByTheme[theme].filter(w => w.length <= gridSize);
      selectedWords = shuffleArray(possibleWords).slice(0, wordCount);
      foundWords = [];
      createGrid();
      music.play();
      musicBtn.textContent = "Pausar M√∫sica";
    }

    function shuffleArray(arr) {
      let array = arr.slice();
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function randomLetter() {
      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
      return letters.charAt(Math.floor(Math.random() * letters.length));
    }

    function createGrid() {
      grid = [];
      gridDiv.innerHTML = '';
      gridDiv.style.gridTemplateColumns = `repeat(${gridSize}, 42px)`;
      gridDiv.style.gridTemplateRows = `repeat(${gridSize}, 42px)`;

      for (let i = 0; i < gridSize; i++) {
        grid[i] = [];
        for (let j = 0; j < gridSize; j++) {
          grid[i][j] = '';
        }
      }


      // Tenta colocar cada palavra na grade e guarda s√≥ as que foram realmente colocadas
let confirmedWords = [];

selectedWords.forEach(word => {
  if (placeWordInGrid(word)) {
    confirmedWords.push(word);
  }
});

selectedWords = confirmedWords;

      // Preenche as posi√ß√µes vazias com letras aleat√≥rias
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          if (grid[i][j] === '') {
            grid[i][j] = randomLetter();
          }
        }
      }

      // Cria as c√©lulas no DOM
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          const cell = document.createElement('div');
          cell.classList.add('cell');
          cell.textContent = grid[i][j];
          cell.dataset.row = i;
          cell.dataset.col = j;

          // Eventos toque e mouse para sele√ß√£o
          cell.addEventListener('mousedown', startSelection);
          cell.addEventListener('touchstart', startSelection, {passive: false});
          cell.addEventListener('mouseenter', moveSelection);
          cell.addEventListener('touchmove', moveSelection, {passive: false});
          cell.addEventListener('mouseup', endSelection);
          cell.addEventListener('touchend', endSelection);

          gridDiv.appendChild(cell);
        }
      }

      // Mostra a lista das palavras
      updateWordList();
    }

    // Tenta colocar palavra no grid numa posi√ß√£o aleat√≥ria com uma dire√ß√£o aleat√≥ria
    function placeWordInGrid(word) {
  const directions = [
    {x: 1, y: 0},   // direita
    {x: -1, y: 0},  // esquerda
    {x: 0, y: 1},   // baixo
    {x: 0, y: -1},  // cima
    {x: 1, y: 1},   // diagonal direita baixo
    {x: 1, y: -1},  // diagonal direita cima
    {x: -1, y: 1},  // diagonal esquerda baixo
    {x: -1, y: -1}  // diagonal esquerda cima
  ];

  let placed = false;
  let attempts = 0;
  while (!placed && attempts < 1000) {
    attempts++;
    const dir = directions[Math.floor(Math.random() * directions.length)];
    const startX = Math.floor(Math.random() * gridSize);
    const startY = Math.floor(Math.random() * gridSize);

    let fits = true;
    let x = startX;
    let y = startY;

    for (let i = 0; i < word.length; i++) {
      if (
        x < 0 || x >= gridSize || y < 0 || y >= gridSize ||
        (grid[y][x] !== '' && grid[y][x] !== word[i])
      ) {
        fits = false;
        break;
      }
      x += dir.x;
      y += dir.y;
    }

    if (fits) {
      x = startX;
      y = startY;
      for (let i = 0; i < word.length; i++) {
        grid[y][x] = word[i];
        x += dir.x;
        y += dir.y;
      }
      placed = true;
    }
  }

  return placed;
}

document.getElementById('backBtn').addEventListener('click', () => {
  // Esconde √°reas do jogo e volta pro menu
  gameArea.classList.add('hidden');
  welcome.classList.remove('hidden');
  startBtn.classList.remove('hidden');
  colorThemeBtn.classList.remove('hidden');
  trocarMusicaBtn.classList.add('hidden');
  catalogoMusicas.classList.add('hidden');
playerBtn.classList.add('hidden');
  playerContainer.classList.add('hidden');
  scoreEl.style.display = 'none';

  // Reinicia o n√≠vel e score visualmente (sem resetar real)
  currentGameLevel = 1;
  updateLevel();
});

    function updateWordList() {
      wordListDiv.innerHTML = '';
      selectedWords.forEach(word => {
        const span = document.createElement('span');
        span.textContent = word;
        if (foundWords.includes(word)) {
          span.classList.add('found');
        }
        wordListDiv.appendChild(span);
      });
    }

    // Seletor de c√©lulas para o toque / clique

    function startSelection(e) {
      e.preventDefault();
      bubbleSound.play();
      clearSelection();
      isSelecting = true;
      const cell = e.target;
      startCell = cell;
      lastCellCoords = {row: +cell.dataset.row, col: +cell.dataset.col};
      selectedCells.push(cell);
      cell.classList.add('selected');
    }

    function moveSelection(e) {
      if (!isSelecting) return;

      e.preventDefault();

      let clientX, clientY;
      if (e.type === 'touchmove') {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }

      const elem = document.elementFromPoint(clientX, clientY);
      if (!elem || !elem.classList.contains('cell')) return;

      const row = +elem.dataset.row;
      const col = +elem.dataset.col;

      // Se a c√©lula j√° foi selecionada, ignora
      if (selectedCells.includes(elem)) return;

      // Calcula o vetor da sele√ß√£o inicial at√© a c√©lula atual
      const startRow = +startCell.dataset.row;
      const startCol = +startCell.dataset.col;

      const dRow = row - startRow;
      const dCol = col - startCol;

      // Se o movimento n√£o est√° numa linha reta nas 8 dire√ß√µes v√°lidas, ignora
      // Valida dire√ß√£o: horizontal, vertical e diagonais s√≥
      if (
        !(dRow === 0 || dCol === 0 || Math.abs(dRow) === Math.abs(dCol))
      ) return;

      // Determina o passo unit√°rio para iterar entre start e c√©lula atual
      const stepRow = dRow === 0 ? 0 : dRow / Math.abs(dRow);
      const stepCol = dCol === 0 ? 0 : dCol / Math.abs(dCol);

      // Limpa sele√ß√£o anterior e seleciona tudo da startCell at√© elem
      clearSelection();
      selectedCells = [];
      let r = startRow;
      let c = startCol;

      while (true) {
        const cellAt = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
        if (!cellAt) break;
        cellAt.classList.add('selected');
        selectedCells.push(cellAt);
        if (r === row && c === col) break;
        r += stepRow;
        c += stepCol;
      }
    }

    function endSelection(e) {
      if (!isSelecting) return;
      isSelecting = false;

      // Pega a palavra selecionada na ordem das c√©lulas selecionadas
      const selectedWord = selectedCells.map(c => c.textContent).join('');
      const selectedWordReversed = selectedCells.map(c => c.textContent).reverse().join('');

      // Verifica se a palavra selecionada est√° na lista de palavras
      if (selectedWords.includes(selectedWord)) {
        markWordFound(selectedWord, selectedCells);
      } else if (selectedWords.includes(selectedWordReversed)) {
        markWordFound(selectedWordReversed, selectedCells);
      } else {
        fail.play();
        clearSelection();
        return;
      }

      clearSelection();

      // Verifica se o jogador achou todas as palavras
      if (foundWords.length === selectedWords.length) {
        score += 10 * currentGameLevel;
        alert(`Parab√©ns! Voc√™ encontrou todas as palavras! +${10 * currentGameLevel} pontos.`);
        currentGameLevel++;
        saveScore();
        updateScore();
        resetGameForNextLevel();
      }
    }

    function markWordFound(word, cells) {
      if (foundWords.includes(word)) return;
      foundWords.push(word);
      success.play();

      // Marca as c√©lulas da palavra com a classe 'correct'
      cells.forEach(c => {
        c.classList.add('correct');
        c.classList.remove('selected');
      });

      updateWordList();
    }

    function clearSelection() {
      selectedCells.forEach(c => c.classList.remove('selected'));
      selectedCells = [];
    }

    function updateScore() {
      scoreEl.textContent = `Pontua√ß√£o: ${score}`;
    }
function resetGameForNextLevel() {
  updateLevel(); // ‚Üê ISSO VAI ATUALIZAR O TEXTO DO N√çVEL CORRETAMENTE
  foundWords = [];
  const possibleWords = wordsByTheme[currentTheme].filter(w => w.length <= gridSize);
  selectedWords = shuffleArray(possibleWords).slice(0, wordCount);
  createGrid();
}

    // Bot√£o para pausar e tocar m√∫sica
    musicBtn.onclick = () => {
      if (music.paused) {
        music.play();
        musicBtn.textContent = "Pausar M√∫sica";
      } else {
        music.pause();
        musicBtn.textContent = "Tocar M√∫sica";
      }
    };

    // Bot√£o para mostrar/esconder cat√°logo de m√∫sicas
    trocarMusicaBtn.onclick = () => {
      if (catalogoMusicas.classList.contains('hidden')) {
        catalogoMusicas.classList.remove('hidden');
      } else {
        catalogoMusicas.classList.add('hidden');
      }
    };

    function trocarMusica(musica) {
      music.pause();
      music.src = musica;
      music.play();
      catalogoMusicas.classList.add('hidden');
      musicBtn.textContent = "Pausar M√∫sica";
      bubbleSound.play();

const nameWithoutExtension = musica.replace(/\.(mp3|wav|ogg)$/i, '');
document.getElementById('musicName').textContent = nameWithoutExtension;
    }

const colorThemeBtn = document.getElementById('colorThemeBtn');
let currentThemeIndex = 0;

const colorThemes = [
  {
    // 1. Azul-roxo
    background: '#0f0c29',
    grid: '#302b63',
    cell: '#42378f',
    selected: '#5c27fe',
    correct: '#1dd3f8',
    text: '#ffffff',
    levelText: '#ffffff',
    scoreText: '#ffffff',
    wordText: '#ffffff'
  },
  {
    // 2. Preto com branco (ajustado)
    background: '#000000',
    grid: '#1a1a1a',
    cell: '#2b2b2b',
    selected: '#222222',       // cinza quase preto
    correct: '#00ffcc',
    text: '#ffffff',
    levelText: '#000000',
    scoreText: '#000000',
    wordText: '#ffffff'        // texto branco nas palavras a encontrar
  },
  {
    // 3. Branco com preto (ajustado)
    background: '#ffffff',
    grid: '#e0e0e0',
    cell: '#cccccc',
    selected: '#000000',       // fundo preto quando seleciona
    correct: '#00ff00',        // verde quando acerta
    text: '#000000',
    levelText: '#ffffff',
    scoreText: '#ffffff',
    wordText: '#ffffff'        // texto branco nas palavras a encontrar
  },
  {
    // 4. Original
    background: '#1a1a1a',
    grid: '#2c2c2c',
    cell: '#444',
    selected: '#240046',
    correct: '#000080',
    text: 'white',
    levelText: '#aaaaaa',
    scoreText: '#aaaaaa',
    wordText: 'white'
  }
];

function applyTheme(theme) {
document.body.style.background = theme.background;

  document.body.style.color = theme.text;

  const gridEl = document.querySelector('.grid');
  if (gridEl) gridEl.style.backgroundColor = theme.grid;

  document.querySelectorAll('.cell').forEach(cell => {
    cell.style.backgroundColor = theme.cell;
    cell.style.color = theme.text;
  });

  document.querySelectorAll('button').forEach(btn => {
    btn.style.backgroundColor = theme.cell;
    btn.style.color = theme.text;
    btn.style.border = 'none';
  });

// Aplica o tema ao bot√£o "Escolher wallpaper" (label)
const wallpaperLabel = document.getElementById('wallpaperLabel');
if (wallpaperLabel) {
  wallpaperLabel.style.backgroundColor = theme.cell;
  wallpaperLabel.style.color = theme.text;
  wallpaperLabel.style.border = 'none';
}

  document.querySelectorAll('.word-list span').forEach(span => {
    span.style.backgroundColor = theme.cell;
    span.style.color = '#ffffff'; // for√ßa branco
  });

  const levelBox = document.getElementById('level');
  if (levelBox) {
    levelBox.style.backgroundColor = theme.selected;
    levelBox.style.color = theme.levelText ?? theme.text;
  }

  const scoreBox = document.getElementById('score');
  if (scoreBox) {
    scoreBox.style.backgroundColor = theme.selected;
    scoreBox.style.color = theme.scoreText ?? theme.text;
  }

  const oldStyle = document.getElementById('dynamic-theme-style');
  if (oldStyle) oldStyle.remove();

  const style = document.createElement('style');
  style.id = 'dynamic-theme-style';
  style.innerHTML = `
    .selected {
      background-color: ${theme.selected} !important;
      color: ${theme.text === '#000000' ? '#ffffff' : theme.text} !important;
    }

    .correct {
      background-color: ${theme.correct} !important;
      color: #ffffff !important;
    }

    .word-list span {
      color: #ffffff !important;
    }
  `;
  document.head.appendChild(style);
}


const uploadInput = document.getElementById('uploadWallpaper');
const wallpaperLabel = document.getElementById('wallpaperLabel');

uploadInput.addEventListener('change', function () {
  const file = this.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function (e) {
      const imageUrl = e.target.result;

      // aplica o fundo
      document.body.style.backgroundImage = `url('${imageUrl}')`;
      document.body.style.backgroundSize = 'cover';
      document.body.style.backgroundPosition = 'center';
      document.body.style.backgroundRepeat = 'no-repeat';

      // salva no localStorage
      localStorage.setItem('wallpaperTutyxs', imageUrl);
    };
    reader.readAsDataURL(file);
  }
});

// Bot√£o para alternar os temas
colorThemeBtn.addEventListener('click', () => {
  currentThemeIndex = (currentThemeIndex + 1) % colorThemes.length;
  applyTheme(colorThemes[currentThemeIndex]);
});

    window.addEventListener('DOMContentLoaded', () => {
  if (!localStorage.getItem('versaoTutyxs3_0')) {
    document.getElementById('updateModal').style.display = 'flex';
  }
});

document.getElementById('closeUpdateModal').addEventListener('click', () => {
  document.getElementById('updateModal').style.display = 'none';
  localStorage.setItem('versaoTutyxs3_0', 'true');
});


const playerBtn = document.getElementById('playerBtn');
const playerContainer = document.getElementById('playerContainer');
const seekBar = document.getElementById('seekBar');

// Mostra ou esconde o player
playerBtn.addEventListener('click', () => {
  if (playerContainer.classList.contains('hidden')) {
    playerContainer.classList.remove('hidden');

    // Mostrar nome da m√∫sica atual
    const fileName = music.src.split('/').pop();
    const nameWithoutExtension = decodeURIComponent(fileName).replace(/\.(mp3|wav|ogg)$/i, '');
    document.getElementById('musicName').textContent = nameWithoutExtension;
  } else {
    playerContainer.classList.add('hidden');
  }
});
// Atualiza barra conforme a m√∫sica toca
music.addEventListener('timeupdate', () => {
  if (!isNaN(music.duration)) {
    seekBar.max = music.duration;
    seekBar.value = music.currentTime;
  }
});

// Permite arrastar para buscar na m√∫sica
seekBar.addEventListener('input', () => {
  music.currentTime = seekBar.value;
});

function voltar10s() {
  music.currentTime = Math.max(0, music.currentTime - 10);
}

function avancar10s() {
  music.currentTime = Math.min(music.duration, music.currentTime + 10);
}


    // Sons est√£o em arquivos musica1.mp3, musica2.mp3, musica3.mp3, success.mp3, fail.mp3, bolha.mp3
    // Para testar som bolha: bubbleSound.play();

  </script>
</body>
</html>
