<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ca√ßa-Palavras Tutyxs 2.0</title>
  <style>
    body {
      background: #1a1a1a;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1, h2 {
      font-size: 2rem;
      margin: 1rem 0;
    }

    button {
      padding: 15px 25px;
      margin: 10px 5px;
      font-size: 1.2rem;
      border: none;
      border-radius: 10px;
      background: #6200ea;
      color: white;
      cursor: pointer;
    }

    button:hover {
      background: #3700b3;
    }

    .hidden {
      display: none;
    }

    .word-section {
      margin-top: 10px;
    }

    .word-section h3 {
      font-size: 1.5rem;
      margin-bottom: 5px;
    }

    .word-list {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .word-list span {
      background: #444;
      padding: 5px 10px;
      border-radius: 5px;
    }

    .word-list .found {
      text-decoration: line-through;
      color: #aaa;
    }

    .grid {
      display: grid;
      gap: 6px;
      justify-content: center;
      background-color: #2c2c2c;
      padding: 15px;
      margin: 30px auto 0;
      width: fit-content;
    }

    .cell {
      width: 42px;
      height: 42px;
      background: #444;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border-radius: 5px;
      user-select: none;
    }

    .selected {
      background-color: #240046;
    }

    .correct {
      background-color: #000080;
    }

    /* Container para os bot√µes no final */
    #gameButtons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }

    #musicBtn {
      background: #333;
      padding: 8px 16px;
      font-size: 1.3rem;
      border-radius: 6px;
      cursor: pointer;
      user-select: none;
      border: none;
      color: white;
    }
    #musicBtn:hover {
      background: #555;
    }
  </style>
</head>
<body>

  <h1 id="welcome">Bem-vindo ao Ca√ßa-Palavras do Tutyxs 2.0</h1>
  <button id="startBtn">Come√ßar Jogo</button>

  <div id="difficulty" class="hidden">
    <h2>Escolha a Dificuldade</h2>
    <button onclick="setDifficulty('facil')">F√°cil</button>
    <button onclick="setDifficulty('medio')">M√©dio</button>
    <button onclick="setDifficulty('dificil')">Dif√≠cil</button>
  </div>

  <div id="themes" class="hidden">
    <h2>Escolha o Tema</h2>
    <div style="overflow-x:auto; white-space:nowrap;">
      <button onclick="startGame('Tecnologia')">Tecnologia</button>
      <button onclick="startGame('Animais')">Animais</button>
      <button onclick="startGame('Escola')">Escola</button>
      <button onclick="startGame('Frutas')">Frutas</button>
      <button onclick="startGame('Espa√ßo')">Espa√ßo</button>
    </div>
  </div>

  <div id="gameArea" class="hidden">
    <div class="word-section">
      <h3>Palavras para encontrar</h3>
      <div class="word-list" id="wordList"></div>
    </div>
    <div id="grid" class="grid"></div>
    <div id="gameButtons">
      <button id="backBtn" onclick="location.reload()">Voltar ao In√≠cio</button>
      <button id="musicBtn" onclick="toggleMusic()">üéµ M√∫sica</button>
    </div>
  </div>

  <audio id="music" src="1-party-anthem.mp3" loop></audio>
  <audio id="success" src="success.mp3"></audio>
  <audio id="fail" src="fail.mp3"></audio>

  <script>
    const wordsByTheme = {
      'Tecnologia': ['APP', 'CLOUD', 'JAVA', 'HTML', 'LINUX', 'SENHA', 'ROBOT', 'WI-FI', 'DADOS', 'CODIGO'],
      'Animais': ['GATO', 'C√ÉO', 'TIGRE', 'PANDA', 'CAVALO', 'RATO', 'CISNE', 'URSO', 'ZEBRA', 'FOCA'],
      'Escola': ['LIVRO', 'L√ÅPIS', 'PROVA', 'RECREIO', 'LI√á√ÉO', 'MESA', 'QUADRO', 'TEXTO', 'AULA', 'NOTA'],
      'Frutas': ['UVA', 'P√äRA', 'BANANA', 'MA√á√É', 'KIWI', 'LIM√ÉO', 'COCO', 'FIGO', 'AMEIXA', 'JABUTI'],
      'Espa√ßo': ['SOL', 'LUZ', 'TERRA', 'SATURNO', 'ASTRO', 'VIA', 'NEBULOSA', 'ROVER', 'NASA', 'F√ìTON']
    };

    const startBtn = document.getElementById('startBtn');
    const welcome = document.getElementById('welcome');
    const difficultyDiv = document.getElementById('difficulty');
    const themesDiv = document.getElementById('themes');
    const gameArea = document.getElementById('gameArea');
    const wordListDiv = document.getElementById('wordList');
    const gridDiv = document.getElementById('grid');
    const music = document.getElementById('music');
    const success = document.getElementById('success');
    const fail = document.getElementById('fail');
    const musicBtn = document.getElementById('musicBtn');

    let grid = [];
    let selectedWords = [];
    let foundWords = [];
    let gridSize = 10;
    let wordCount = 10;

    // Sele√ß√£o din√¢mica
    let isSelecting = false;
    let startCell = null; // {r,c,el}
    let selectedCells = [];

    startBtn.onclick = () => {
      startBtn.classList.add('hidden');
      welcome.classList.add('hidden');
      difficultyDiv.classList.remove('hidden');
    };

    function setDifficulty(level) {
      difficultyDiv.classList.add('hidden');
      themesDiv.classList.remove('hidden');
      if (level === 'facil') {
        gridSize = 6;
        wordCount = 4;
      } else if (level === 'medio') {
        gridSize = 8;
        wordCount = 7;
      } else {
        gridSize = 10;
        wordCount = 10;
      }
    }

    function startGame(theme) {
      themesDiv.classList.add('hidden');
      gameArea.classList.remove('hidden');
      selectedWords = wordsByTheme[theme].slice(0, wordCount);
      foundWords = [];
      createGrid();
      music.play();
      musicBtn.textContent = "‚è∏Ô∏è Pausar M√∫sica";
    }

    function createGrid() {
      grid = Array.from({ length: gridSize }, () => Array(gridSize).fill(''));
      wordListDiv.innerHTML = '';
      selectedWords.forEach(word => {
        placeWord(word.toUpperCase());
        const span = document.createElement('span');
        span.textContent = word;
        span.id = 'word-' + word;
        wordListDiv.appendChild(span);
      });
      fillEmpty();
      renderGrid();
    }

    function placeWord(word) {
      let placed = false;
      const directions = [
        { dr: 0, dc: 1 },
        { dr: 1, dc: 0 },
        { dr: 1, dc: 1 },
        { dr: 1, dc: -1 }
      ];

      while (!placed) {
        const { dr, dc } = directions[Math.floor(Math.random() * directions.length)];
        const row = Math.floor(Math.random() * gridSize);
        const col = Math.floor(Math.random() * gridSize);

        let canPlace = true;
        for (let i = 0; i < word.length; i++) {
          const r = row + dr * i;
          const c = col + dc * i;
          if (r < 0 || r >= gridSize || c < 0 || c >= gridSize || (grid[r][c] && grid[r][c] !== word[i])) {
            canPlace = false;
            break;
          }
        }

        if (canPlace) {
          for (let i = 0; i < word.length; i++) {
            const r = row + dr * i;
            const c = col + dc * i;
            grid[r][c] = word[i];
          }
          placed = true;
        }
      }
    }

    function fillEmpty() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      for (let r = 0; r < gridSize; r++) {
        for (let c = 0; c < gridSize; c++) {
          if (!grid[r][c]) {
            grid[r][c] = letters[Math.floor(Math.random() * letters.length)];
          }
        }
      }
    }

    function renderGrid() {
      gridDiv.innerHTML = '';
      gridDiv.style.gridTemplateColumns = `repeat(${gridSize}, 42px)`;
      grid.forEach((row, r) => {
        row.forEach((letter, c) => {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.textContent = letter;
          cell.dataset.row = r;
          cell.dataset.col = c;

          // Eventos para toque e mouse
          cell.addEventListener('touchstart', selectStart);
          cell.addEventListener('touchmove', selectMove);
          cell.addEventListener('touchend', selectEnd);

          cell.addEventListener('mousedown', selectStart);
          cell.addEventListener('mousemove', selectMove);
          cell.addEventListener('mouseup', selectEnd);

          gridDiv.appendChild(cell);
        });
      });
    }

    function selectStart(e) {
      e.preventDefault();
      const cell = getCellFromEvent(e);
      if (!cell) return;
      isSelecting = true;
      startCell = cell;
      updateSelection(cell);
    }

    function selectMove(e) {
      if (!isSelecting) return;
      e.preventDefault();
      const cell = getCellFromEvent(e);
      if (!cell) return;
      updateSelection(cell);
    }

    function selectEnd(e) {
      if (!isSelecting) return;
      e.preventDefault();
      isSelecting = false;
      if (selectedCells.length === 0) {
        clearSelection();
        return;
      }

      const word = selectedCells.map(c => grid[c.r][c.c]).join('');
      const reversed = word.split('').reverse().join('');
      const match = selectedWords.find(w => (w === word || w === reversed) && !foundWords.includes(w));

      if (match) {
        selectedCells.forEach(c => c.el.classList.replace('selected', 'correct'));
        document.getElementById('word-' + match).classList.add('found');
        foundWords.push(match);
        success.play();
        if (foundWords.length === selectedWords.length) {
          alert("Parab√©ns! Voc√™ encontrou todas as palavras!");
        }
      } else {
        fail.play();
        clearSelection();
      }

      startCell = null;
      selectedCells = [];
    }

    // Pega c√©lula pelo evento (mouse ou toque)
    function getCellFromEvent(e) {
      const point = e.touches ? e.touches[0] : e;
      const target = document.elementFromPoint(point.clientX, point.clientY);
      if (!target || !target.classList.contains('cell')) return null;

      const r = +target.dataset.row;
      const c = +target.dataset.col;
      return { r, c, el: target };
    }

    // Atualiza sele√ß√£o entre startCell e cell numa linha reta horizontal, vertical ou diagonal
    function updateSelection(cell) {
      if (!startCell) return;

      const dr = cell.r - startCell.r;
      const dc = cell.c - startCell.c;

      function normalize(n) {
        if (n === 0) return 0;
        return n > 0 ? 1 : -1;
      }

      const ndR = normalize(dr);
      const ndC = normalize(dc);

      // Valida se a dire√ß√£o √© horizontal, vertical ou diagonal perfeita
      if (ndR !== 0 && ndC !== 0 && Math.abs(dr) !== Math.abs(dc)) {
        // dire√ß√£o inv√°lida (n√£o reta diagonal)
        return;
      }

      clearSelection();
      selectedCells = [];

      let steps = Math.max(Math.abs(dr), Math.abs(dc));
      for (let i = 0; i <= steps; i++) {
        const rr = startCell.r + ndR * i;
        const cc = startCell.c + ndC * i;

        if (rr < 0 || rr >= gridSize || cc < 0 || cc >= gridSize) break;

        const el = gridDiv.querySelector(`.cell[data-row="${rr}"][data-col="${cc}"]`);
        if (el) {
          el.classList.add('selected');
          selectedCells.push({ r: rr, c: cc, el });
        }
      }
    }

    function clearSelection() {
      selectedCells.forEach(c => c.el.classList.remove('selected'));
      selectedCells = [];
    }

    function toggleMusic() {
      if (music.paused) {
        music.play();
        musicBtn.textContent = "‚è∏Ô∏è Pausar M√∫sica";
      } else {
        music.pause();
        musicBtn.textContent = "üéµ Tocar M√∫sica";
      }
    }
  </script>
</body>
  </html>
